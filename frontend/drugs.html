<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drug Dictionary Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-50 font-sans pb-20 sm:pb-0">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <h1 class="text-xl font-bold text-gray-800">Drug Dictionary</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="export-btn" onclick="exportDrugs()"
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hidden">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Export CSV
                    </button>
                    <button id="import-btn" onclick="showImportModal()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hidden">
                        <i data-lucide="upload" class="w-4 h-4"></i>
                        Import
                    </button>
                    <button onclick="showAddModal()"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Add Drug
                    </button>
                    <button id="login-btn" onclick="showLoginModal()"
                        class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                        <i data-lucide="lock" class="w-4 h-4"></i>
                        Login
                    </button>
                    <button id="logout-btn" onclick="logout()"
                        class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hidden">
                        <i data-lucide="unlock" class="w-4 h-4"></i>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Section -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8" id="stats-container">
            <!-- Stats will be loaded here dynamically -->
        </div>

        <!-- Search and Filters -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <input type="text" id="search-input"
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="Search by drug name, brand, or category...">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i data-lucide="search" class="h-5 w-5 text-gray-400"></i>
                        </div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <select id="category-filter"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">All Categories</option>
                    </select>
                    <select id="form-filter"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">All Forms</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Drugs Table -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Drug</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Brand Name</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Form & Strength</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Category</th>
                            <th scope="col"
                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Manufacturer</th>
                            <th scope="col"
                                class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="drugs-table-body">
                        <!-- Drugs will be loaded here dynamically -->
                    </tbody>
                </table>
            </div>
            <div class="bg-white px-6 py-4 border-t border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-700">
                        Showing <span id="page-info">0</span> results
                    </div>
                    <div class="flex space-x-2">
                        <button id="prev-page"
                            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Previous
                        </button>
                        <button id="next-page"
                            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Next
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Drug Modal -->
    <div id="drug-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900" id="modal-title">Add New Drug</h3>
            </div>
            <div class="px-6 py-4">
                <form id="drug-form" class="space-y-6">
                    <input type="hidden" id="drug-id">
                    
                    <!-- Identity Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Identity</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="generic-name" class="block text-sm font-medium text-gray-700 mb-1">Generic Name</label>
                                <input type="text" id="generic-name"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="brand-name" class="block text-sm font-medium text-gray-700 mb-1">Brand Name</label>
                                <input type="text" id="brand-name"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="alternative-names" class="block text-sm font-medium text-gray-700 mb-1">Alternative Names (comma separated)</label>
                                <input type="text" id="alternative-names"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="atc-code" class="block text-sm font-medium text-gray-700 mb-1">ATC Code</label>
                                <input type="text" id="atc-code"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>

                    <!-- Strength & Form Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Strength & Form</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="strength" class="block text-sm font-medium text-gray-700 mb-1">Strength</label>
                                <input type="text" id="strength"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="form" class="block text-sm font-medium text-gray-700 mb-1">Form</label>
                                <select id="form"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select Form</option>
                                    <option value="Tablet">Tablet</option>
                                    <option value="Capsule">Capsule</option>
                                    <option value="Syrup">Syrup</option>
                                    <option value="Injection">Injection</option>
                                    <option value="Cream">Cream</option>
                                    <option value="Ointment">Ointment</option>
                                    <option value="Drops">Drops</option>
                                    <option value="Inhaler">Inhaler</option>
                                    <option value="Suspension">Suspension</option>
                                    <option value="Solution">Solution</option>
                                    <option value="Powder">Powder</option>
                                    <option value="Gel">Gel</option>
                                    <option value="Patch">Patch</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Classification Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Classification</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <input type="text" id="category"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="sub-category" class="block text-sm font-medium text-gray-700 mb-1">Sub Category</label>
                                <input type="text" id="sub-category"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="drug-type" class="block text-sm font-medium text-gray-700 mb-1">Drug Type</label>
                                <select id="drug-type"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select Type</option>
                                    <option value="ethical">Ethical</option>
                                    <option value="generic">Generic</option>
                                    <option value="otc">OTC</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Manufacturer & Supply Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Manufacturer & Supply</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="manufacturer" class="block text-sm font-medium text-gray-700 mb-1">Manufacturer</label>
                                <input type="text" id="manufacturer"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="country-of-origin" class="block text-sm font-medium text-gray-700 mb-1">Country of Origin</label>
                                <input type="text" id="country-of-origin"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="schedule-type" class="block text-sm font-medium text-gray-700 mb-1">Schedule Type</label>
                                <input type="text" id="schedule-type"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="unii-code" class="block text-sm font-medium text-gray-700 mb-1">UNII Code</label>
                                <input type="text" id="unii-code"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>

                    <!-- Medical Info Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Medical Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="primary-use" class="block text-sm font-medium text-gray-700 mb-1">Primary Use</label>
                                <textarea id="primary-use" rows="2"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div>
                                <label for="secondary-use" class="block text-sm font-medium text-gray-700 mb-1">Secondary Use</label>
                                <textarea id="secondary-use" rows="2"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div>
                                <label for="common-dosage" class="block text-sm font-medium text-gray-700 mb-1">Common Dosage</label>
                                <input type="text" id="common-dosage"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="route-of-administration" class="block text-sm font-medium text-gray-700 mb-1">Route of Administration</label>
                                <input type="text" id="route-of-administration"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="flex items-center pt-6">
                                <input type="checkbox" id="prescription-required" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="prescription-required" class="ml-2 block text-sm text-gray-700">Prescription Required</label>
                            </div>
                        </div>
                    </div>

                    <!-- Safety Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Safety Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="pregnancy-warning" class="block text-sm font-medium text-gray-700 mb-1">Pregnancy Warning</label>
                                <select id="pregnancy-warning"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select Warning</option>
                                    <option value="safe">Safe</option>
                                    <option value="caution">Caution</option>
                                    <option value="not safe">Not Safe</option>
                                </select>
                            </div>
                            <div>
                                <label for="alcohol-interaction" class="block text-sm font-medium text-gray-700 mb-1">Alcohol Interaction</label>
                                <input type="text" id="alcohol-interaction"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label for="common-side-effects" class="block text-sm font-medium text-gray-700 mb-1">Common Side Effects</label>
                                <textarea id="common-side-effects" rows="2"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label for="contraindications" class="block text-sm font-medium text-gray-700 mb-1">Contraindications</label>
                                <textarea id="contraindications" rows="2"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Regulatory & Compliance Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Regulatory & Compliance</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center">
                                <input type="checkbox" id="fda-approval" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="fda-approval" class="ml-2 block text-sm text-gray-700">FDA Approved</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="who-essential-medicine" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                <label for="who-essential-medicine" class="ml-2 block text-sm text-gray-700">WHO Essential Medicine</label>
                            </div>
                        </div>
                    </div>

                    <!-- Online Pharmacy Specific Fields -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Online Pharmacy Details</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="pack-size" class="block text-sm font-medium text-gray-700 mb-1">Pack Size</label>
                                <input type="text" id="pack-size"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="availability-status" class="block text-sm font-medium text-gray-700 mb-1">Availability Status</label>
                                <select id="availability-status"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    <option value="">Select Status</option>
                                    <option value="In Stock">In Stock</option>
                                    <option value="Out of Stock">Out of Stock</option>
                                    <option value="Discontinued">Discontinued</option>
                                </select>
                            </div>
                            <div>
                                <label for="last-updated-online" class="block text-sm font-medium text-gray-700 mb-1">Last Updated Online</label>
                                <input type="date" id="last-updated-online"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>

                    <!-- Price Tracking Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Price Tracking</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="min-price" class="block text-sm font-medium text-gray-700 mb-1">Minimum Price</label>
                                <input type="number" step="0.01" id="min-price"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="max-price" class="block text-sm font-medium text-gray-700 mb-1">Maximum Price</label>
                                <input type="number" step="0.01" id="max-price"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="price-currency" class="block text-sm font-medium text-gray-700 mb-1">Currency</label>
                                <input type="text" id="price-currency" value="INR"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>

                    <!-- Image & Description Section -->
                    <div>
                        <h4 class="text-md font-medium text-gray-900 mb-3">Image & Description</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label for="image-url" class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                                <input type="text" id="image-url"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea id="description" rows="3"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3">
                <button type="button" onclick="closeModal()"
                    class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Cancel
                </button>
                <button type="button" onclick="saveDrug()"
                    class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Save Drug
                </button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Admin Login</h3>
            </div>
            <div class="px-6 py-4">
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </form>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3">
                <button type="button" onclick="closeLoginModal()"
                    class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Cancel
                </button>
                <button type="button" onclick="login()"
                    class="px-4 py-2 bg-gray-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                    Login
                </button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Import Drugs</h3>
            </div>
            <div class="px-6 py-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload File</label>
                        <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                            <div class="space-y-1 text-center">
                                <div class="flex text-sm text-gray-600">
                                    <label for="import-file"
                                        class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500">
                                        <span>Upload a file</span>
                                        <input id="import-file" name="import-file" type="file" class="sr-only" accept=".csv,.json">
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                </div>
                                <p class="text-xs text-gray-500" id="filename">CSV or JSON files only</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3">
                <button type="button" onclick="closeImportModal()"
                    class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Cancel
                </button>
                <button type="button" onclick="importDrugs()"
                    class="px-4 py-2 bg-blue-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Import
                </button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Admin Login</h3>
            </div>
            <div class="px-6 py-4">
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                        <input type="text" id="username" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </form>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex justify-end space-x-3">
                <button type="button" onclick="closeLoginModal()"
                    class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Cancel
                </button>
                <button type="button" onclick="login()"
                    class="px-4 py-2 bg-gray-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                    Login
                </button>
            </div>
        </div>
    </div>

    <script>
        // API base URL
        const API_BASE = '..';

        // Global variables
        let currentPage = 0;
        const pageSize = 10;

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            loadStats();
            loadDrugs();
            setupEventListeners();
        });

        // Set up event listeners
        function setupEventListeners() {
            // Search input
            document.getElementById('search-input').addEventListener('input', debounce(loadDrugs, 300));
            
            // Filter selects
            document.getElementById('category-filter').addEventListener('change', loadDrugs);
            document.getElementById('form-filter').addEventListener('change', loadDrugs);
            
            // Pagination
            document.getElementById('prev-page').addEventListener('click', () => {
                if (currentPage > 0) {
                    currentPage--;
                    loadDrugs();
                }
            });
            
            document.getElementById('next-page').addEventListener('click', () => {
                currentPage++;
                loadDrugs();
            });
            
            // File input
            document.getElementById('import-file').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || 'CSV or JSON files only';
                document.getElementById('filename').textContent = fileName;
            });
        }

        // Load statistics
        async function loadStats() {
            try {
                const res = await fetch(`${API_BASE}/api/drugs/stats`);
                const stats = await res.json();
                
                const statsContainer = document.getElementById('stats-container');
                statsContainer.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-indigo-100">
                                <i data-lucide="pill" class="h-6 w-6 text-indigo-600"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-sm font-medium text-gray-500">Total Drugs</h3>
                                <p class="text-2xl font-semibold text-gray-900">${stats.total_drugs || 0}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100">
                                <i data-lucide="layers" class="h-6 w-6 text-green-600"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-sm font-medium text-gray-500">Categories</h3>
                                <p class="text-2xl font-semibold text-gray-900">${Object.keys(stats.categories || {}).length || 0}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100">
                                <i data-lucide="package" class="h-6 w-6 text-blue-600"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-sm font-medium text-gray-500">Forms</h3>
                                <p class="text-2xl font-semibold text-gray-900">${Object.keys(stats.forms || {}).length || 0}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100">
                                <i data-lucide="tag" class="h-6 w-6 text-purple-600"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-sm font-medium text-gray-500">Drug Types</h3>
                                <p class="text-2xl font-semibold text-gray-900">${Object.keys(stats.drug_types || {}).length || 0}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                // Populate category and form dropdowns
                populateCategoryFilter(stats.categories || {});
                populateFormFilter(stats.forms || {});
                
                lucide.createIcons();
            } catch (err) {
                console.error('Error loading stats:', err);
            }
        }
        
        // Populate category filter dropdown
        function populateCategoryFilter(categories) {
            const categoryFilter = document.getElementById('category-filter');
            
            // Clear existing options except the first one
            while (categoryFilter.options.length > 1) {
                categoryFilter.remove(1);
            }
            
            // Add category options
            Object.keys(categories).sort().forEach(category => {
                if (category) { // Only add non-empty categories
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categoryFilter.appendChild(option);
                }
            });
        }
        
        // Populate form filter dropdown
        function populateFormFilter(forms) {
            const formFilter = document.getElementById('form-filter');
            
            // Clear existing options except the first one
            while (formFilter.options.length > 1) {
                formFilter.remove(1);
            }
            
            // Add form options
            Object.keys(forms).sort().forEach(form => {
                if (form) { // Only add non-empty forms
                    const option = document.createElement('option');
                    option.value = form;
                    option.textContent = form;
                    formFilter.appendChild(option);
                }
            });
        }

        // Load drugs with filters and pagination
        async function loadDrugs() {
            try {
                const searchQuery = document.getElementById('search-input').value;
                const categoryFilter = document.getElementById('category-filter').value;
                const formFilter = document.getElementById('form-filter').value;
                
                // Build query parameters
                const params = new URLSearchParams({
                    skip: currentPage * pageSize,
                    limit: pageSize
                });
                
                if (searchQuery) {
                    // For search, we use the search endpoint
                    const res = await fetch(`${API_BASE}/api/drugs/search?q=${encodeURIComponent(searchQuery)}&limit=${pageSize}`);
                    const data = await res.json();
                    
                    renderDrugsTable(data.results || []);
                    updatePagination(data.results ? data.results.length : 0);
                } else {
                    // For listing, we use the main endpoint
                    const res = await fetch(`${API_BASE}/api/drugs?${params}`);
                    const data = await res.json();
                    
                    renderDrugsTable(data.results || data || []);
                    updatePagination(data.results ? data.results.length : (data.length || 0));
                }
            } catch (err) {
                console.error('Error loading drugs:', err);
                renderDrugsTable([]);
            }
        }

        // Render drugs table
        function renderDrugsTable(drugs) {
            const tbody = document.getElementById('drugs-table-body');
            
            if (!drugs || drugs.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">
                            No drugs found
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = drugs.map(drug => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium text-gray-900">${drug.generic_name || 'N/A'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                        ${drug.brand_name || 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                        ${drug.form ? `${drug.form}${drug.strength ? ` (${drug.strength})` : ''}` : 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                        ${drug.category || 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                        ${drug.manufacturer || 'N/A'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button onclick="showEditModal(${drug.id})" class="text-indigo-600 hover:text-indigo-900 mr-3">
                            Edit
                        </button>
                        <button onclick="deleteDrug(${drug.id})" class="text-red-600 hover:text-red-900">
                            Delete
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Update pagination controls
        function updatePagination(resultCount) {
            document.getElementById('page-info').textContent = 
                `${currentPage * pageSize + 1} - ${currentPage * pageSize + resultCount}`;
            
            document.getElementById('prev-page').disabled = currentPage === 0;
            // Next button enable/disable logic would depend on whether there are more results
        }

        // Show add modal
        function showAddModal() {
            document.getElementById('modal-title').textContent = 'Add New Drug';
            document.getElementById('drug-form').reset();
            document.getElementById('drug-id').value = '';
            document.getElementById('drug-modal').classList.remove('hidden');
            document.getElementById('drug-modal').classList.add('flex');
        }

        // Show edit modal
        async function showEditModal(id) {
            try {
                const res = await fetch(`${API_BASE}/api/drugs/${id}`);
                const drug = await res.json();
                
                document.getElementById('modal-title').textContent = 'Edit Drug';
                document.getElementById('drug-id').value = drug.id || '';
                document.getElementById('generic-name').value = drug.generic_name || '';
                document.getElementById('brand-name').value = drug.brand_name || '';
                document.getElementById('alternative-names').value = drug.alternative_names || '';
                document.getElementById('atc-code').value = drug.atc_code || '';
                document.getElementById('strength').value = drug.strength || '';
                document.getElementById('form').value = drug.form || '';
                document.getElementById('category').value = drug.category || '';
                document.getElementById('sub-category').value = drug.sub_category || '';
                document.getElementById('drug-type').value = drug.drug_type || '';
                document.getElementById('manufacturer').value = drug.manufacturer || '';
                document.getElementById('country-of-origin').value = drug.country_of_origin || '';
                document.getElementById('schedule-type').value = drug.schedule_type || '';
                document.getElementById('unii-code').value = drug.unii_code || '';
                document.getElementById('primary-use').value = drug.primary_use || '';
                document.getElementById('secondary-use').value = drug.secondary_use || '';
                document.getElementById('common-dosage').value = drug.common_dosage || '';
                document.getElementById('route-of-administration').value = drug.route_of_administration || '';
                document.getElementById('prescription-required').checked = drug.prescription_required || false;
                document.getElementById('pregnancy-warning').value = drug.pregnancy_warning || '';
                document.getElementById('alcohol-interaction').value = drug.alcohol_interaction || '';
                document.getElementById('common-side-effects').value = drug.common_side_effects || '';
                document.getElementById('contraindications').value = drug.contraindications || '';
                document.getElementById('fda-approval').checked = drug.fda_approval || false;
                document.getElementById('who-essential-medicine').checked = drug.who_essential_medicine || false;
                document.getElementById('pack-size').value = drug.pack_size || '';
                document.getElementById('availability-status').value = drug.availability_status || '';
                document.getElementById('last-updated-online').value = drug.last_updated_online ? drug.last_updated_online.split('T')[0] : '';
                document.getElementById('min-price').value = drug.min_price || '';
                document.getElementById('max-price').value = drug.max_price || '';
                document.getElementById('price-currency').value = drug.price_currency || 'INR';
                document.getElementById('image-url').value = drug.image_url || '';
                document.getElementById('description').value = drug.description || '';
                
                document.getElementById('drug-modal').classList.remove('hidden');
                document.getElementById('drug-modal').classList.add('flex');
            } catch (err) {
                alert(`Error loading drug: ${err.message}`);
            }
        }

        // Save drug (add or update)
        async function saveDrug() {
            const id = document.getElementById('drug-id').value;
            const data = {
                // Identity
                generic_name: document.getElementById('generic-name').value || null,
                brand_name: document.getElementById('brand-name').value || null,
                alternative_names: document.getElementById('alternative-names').value || null,
                atc_code: document.getElementById('atc-code').value || null,
                
                // Strength & form
                strength: document.getElementById('strength').value || null,
                form: document.getElementById('form').value || null,
                
                // Classification
                category: document.getElementById('category').value || null,
                sub_category: document.getElementById('sub-category').value || null,
                drug_type: document.getElementById('drug-type').value || null,
                
                // Manufacturer & supply
                manufacturer: document.getElementById('manufacturer').value || null,
                country_of_origin: document.getElementById('country-of-origin').value || null,
                schedule_type: document.getElementById('schedule-type').value || null,
                unii_code: document.getElementById('unii-code').value || null,
                
                // Medical info
                primary_use: document.getElementById('primary-use').value || null,
                secondary_use: document.getElementById('secondary-use').value || null,
                common_dosage: document.getElementById('common-dosage').value || null,
                route_of_administration: document.getElementById('route-of-administration').value || null,
                prescription_required: document.getElementById('prescription-required').checked,
                
                // Safety
                pregnancy_warning: document.getElementById('pregnancy-warning').value || null,
                alcohol_interaction: document.getElementById('alcohol-interaction').value || null,
                common_side_effects: document.getElementById('common-side-effects').value || null,
                contraindications: document.getElementById('contraindications').value || null,
                
                // Regulatory & Compliance
                fda_approval: document.getElementById('fda-approval').checked,
                who_essential_medicine: document.getElementById('who-essential-medicine').checked,
                
                // Online Pharmacy Specific Fields
                pack_size: document.getElementById('pack-size').value || null,
                availability_status: document.getElementById('availability-status').value || null,
                last_updated_online: document.getElementById('last-updated-online').value || null,
                
                // Price Tracking
                min_price: document.getElementById('min-price').value ? parseFloat(document.getElementById('min-price').value) : null,
                max_price: document.getElementById('max-price').value ? parseFloat(document.getElementById('max-price').value) : null,
                price_currency: document.getElementById('price-currency').value || 'INR',
                
                // Image & Description
                image_url: document.getElementById('image-url').value || null,
                description: document.getElementById('description').value || null
            };
            
            try {
                const url = id ? `${API_BASE}/api/drugs/${id}` : `${API_BASE}/api/drugs/`;
                const method = id ? 'PUT' : 'POST';
                
                // Prepare headers
                const headers = { 'Content-Type': 'application/json' };
                
                // Add authorization header for update operations (admin only)
                if (id) {
                    const authHeaders = getAuthHeaders();
                    Object.assign(headers, authHeaders);
                }
                
                const res = await fetch(url, {
                    method,
                    headers: headers,
                    body: JSON.stringify(data)
                });
                
                if (res.ok) {
                    closeModal();
                    loadDrugs();
                    loadStats();
                    alert(id ? 'Drug updated successfully!' : 'Drug added successfully!');
                } else {
                    const errorData = await res.json();
                    alert(`Failed to save drug: ${errorData.detail || 'Unknown error'}`);
                }
            } catch (err) {
                alert(`Error saving drug: ${err.message}`);
            }
        }

        // Delete drug
        async function deleteDrug(id) {
            if (!confirm('Are you sure you want to delete this drug?')) return;
            
            try {
                const headers = getAuthHeaders();
                const res = await fetch(`${API_BASE}/api/drugs/${id}`, { 
                    method: 'DELETE',
                    headers: headers
                });
                if (res.ok) {
                    loadDrugs();
                    loadStats();
                    alert('Drug deleted successfully!');
                } else {
                    const errorData = await res.json();
                    alert(`Failed to delete drug: ${errorData.detail || 'Unknown error'}`);
                }
            } catch (err) {
                alert(`Error deleting drug: ${err.message}`);
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('drug-modal').classList.add('hidden');
            document.getElementById('drug-modal').classList.remove('flex');
        }

        // Show import modal
        function showImportModal() {
            document.getElementById('import-modal').classList.remove('hidden');
            document.getElementById('import-modal').classList.add('flex');
        }

        // Close import modal
        function closeImportModal() {
            document.getElementById('import-modal').classList.add('hidden');
            document.getElementById('import-modal').classList.remove('flex');
            document.getElementById('import-file').value = '';
            document.getElementById('filename').textContent = 'CSV or JSON files only';
        }

        // Import drugs
        async function importDrugs() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a file');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const headers = getAuthHeaders();
                const res = await fetch(`${API_BASE}/api/drugs/bulk-import`, {
                    method: 'POST',
                    headers: headers,
                    body: formData
                });
                
                const data = await res.json();
                
                if (res.ok) {
                    closeImportModal();
                    loadDrugs();
                    loadStats();
                    alert(`Successfully imported ${data.imported} drugs!`);
                } else {
                    alert(`Import failed: ${data.detail}`);
                }
            } catch (err) {
                alert(`Error importing drugs: ${err.message}`);
            }
        }

        // Export drugs
        async function exportDrugs() {
            try {
                const headers = getAuthHeaders();
                // First check if we have permission
                const response = await fetch(`${API_BASE}/api/drugs/export/csv`, {
                    headers: headers
                });
                
                if (response.ok) {
                    // If authorized, trigger download
                    window.location.href = `${API_BASE}/api/drugs/export/csv`;
                } else {
                    const errorData = await response.json();
                    alert(`Export failed: ${errorData.detail || 'Unauthorized access - please login as admin'}`);
                }
            } catch (err) {
                alert(`Export failed: ${err.message}`);
            }
        }

        // Utility function for debouncing
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Authentication functions
        let authToken = null;

        // Show login modal
        function showLoginModal() {
            document.getElementById('login-modal').classList.remove('hidden');
            document.getElementById('login-modal').classList.add('flex');
        }

        // Close login modal
        function closeLoginModal() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('login-modal').classList.remove('flex');
            document.getElementById('login-form').reset();
        }

        // Login function
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_BASE}/api/login`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic ' + btoa(username + ':' + password),
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    
                    // Hide login button and show logout button
                    document.getElementById('login-btn').classList.add('hidden');
                    document.getElementById('logout-btn').classList.remove('hidden');
                    
                    // Show admin buttons
                    document.getElementById('export-btn').classList.remove('hidden');
                    document.getElementById('import-btn').classList.remove('hidden');
                    
                    closeLoginModal();
                    alert('Login successful!');
                } else {
                    const errorData = await response.json();
                    alert(`Login failed: ${errorData.detail || 'Invalid credentials'}
`);
                }
            } catch (err) {
                alert(`Login error: ${err.message}`);
            }
        }

        // Logout function
        async function logout() {
            if (!authToken) return;

            try {
                await fetch(`${API_BASE}/api/logout`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token: authToken })
                });

                authToken = null;
                
                // Show login button and hide logout button
                document.getElementById('login-btn').classList.remove('hidden');
                document.getElementById('logout-btn').classList.add('hidden');
                
                // Hide admin buttons
                document.getElementById('export-btn').classList.add('hidden');
                document.getElementById('import-btn').classList.add('hidden');
                
                alert('Logged out successfully!');
            } catch (err) {
                alert(`Logout error: ${err.message}`);
            }
        }

        // Add authorization header to API requests that need it
        function getAuthHeaders() {
            const headers = {};
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            return headers;
        }
    </script>
</body>

</html>